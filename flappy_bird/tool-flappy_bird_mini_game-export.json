[{"id":"flappy_bird_mini_game","user_id":"418fe105-9a5c-4772-bec2-8b50817310d0","name":"üê•Flappy Bird Mini Game","content":"\"\"\"\ntitle: üê• Flappy Bird Mini Game\nauthor: Helmi Chaouachi\ngit_url: https://github.com/Helmi97/open-webui-extensions/tree/main/flappy_bird\ndescription: A Flappy Bird style mini game with random pipe widths, gaps, and spacing, difficulty-based speed scaling, and configurable behavior via Open WebUI valves.\nrequired_open_webui_version: 0.4.0\nrequirements:\nversion: 1.2.0\nlicence: MIT\n\"\"\"\n\nfrom fastapi.responses import HTMLResponse\nfrom pydantic import BaseModel, Field\n\n\nclass Tools:\n    class Valves(BaseModel):\n        speed: float = Field(\n            default=1.0,\n            ge=0.5,\n            le=2.0,\n            description=\"Global speed multiplier (0.5x to 2.0x).\",\n        )\n        gravity: float = Field(\n            default=0.4,\n            ge=0.2,\n            le=1.0,\n            description=\"Gravity strength applied each frame.\",\n        )\n        jump_force: float = Field(\n            default=-7.5,\n            ge=-15.0,\n            le=-3.0,\n            description=\"Upward velocity applied on flap.\",\n        )\n        min_gap: int = Field(\n            default=90,\n            ge=60,\n            le=220,\n            description=\"Minimum vertical gap between pipes.\",\n        )\n        max_gap: int = Field(\n            default=140,\n            ge=70,\n            le=260,\n            description=\"Maximum vertical gap between pipes.\",\n        )\n        min_pipe_distance: int = Field(\n            default=150,\n            ge=80,\n            le=400,\n            description=\"Minimum horizontal distance between pipes (px).\",\n        )\n        max_pipe_distance: int = Field(\n            default=260,\n            ge=100,\n            le=500,\n            description=\"Maximum horizontal distance between pipes (px).\",\n        )\n        min_pipe_width: int = Field(\n            default=45,\n            ge=30,\n            le=120,\n            description=\"Minimum pipe width (px).\",\n        )\n        max_pipe_width: int = Field(\n            default=65,\n            ge=35,\n            le=140,\n            description=\"Maximum pipe width (px).\",\n        )\n        save_scores: bool = Field(\n            default=True,\n            description=\"Persist best score in browser localStorage.\",\n        )\n        difficulty: str = Field(\n            default=\"normal\",\n            description=\"Difficulty preset (base speed and scaling).\",\n            json_schema_extra={\"enum\": [\"easy\", \"normal\", \"hard\"]},\n        )\n\n    def __init__(self):\n        self.valves = self.Valves()\n\n    def start_flappy_bird(self) -> HTMLResponse:\n        v = self.valves\n\n        html_content = f\"\"\"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>Flappy Bird Mini Game</title>\n  <style>\n    * {{\n      box-sizing: border-box;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif;\n    }}\n\n    body {{\n      margin: 0;\n      padding: 10px;\n      background: #020617;\n      color: #e5e7eb;\n      display: flex;\n      justify-content: center;\n    }}\n\n    .wrapper {{\n      width: 100%;\n      max-width: 480px;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n    }}\n\n    h1 {{\n      margin: 0 0 4px 0;\n      font-size: 16px;\n      text-align: center;\n      color: #e5e7eb;\n    }}\n\n    .subtitle {{\n      margin: 0 0 8px 0;\n      font-size: 11px;\n      text-align: center;\n      color: #9ca3af;\n    }}\n\n    .game-card {{\n      position: relative;\n      max-width: 100%;\n      border-radius: 12px;\n      padding: 10px;\n      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);\n      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.7);\n      transition: box-shadow 0.2s ease-out;\n    }}\n\n    .game-card.focused {{\n      box-shadow:\n        0 0 18px rgba(59, 130, 246, 0.45),\n        0 0 6px rgba(59, 130, 246, 0.6),\n        0 10px 24px rgba(0, 0, 0, 0.7);\n    }}\n\n    .hud {{\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 6px;\n      font-size: 12px;\n      color: #d1d5db;\n      gap: 8px;\n      flex-wrap: wrap;\n    }}\n\n    .hud-left {{\n      display: flex;\n      flex-direction: column;\n      gap: 2px;\n    }}\n\n    .hud-row {{\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      flex-wrap: wrap;\n    }}\n\n    .btn {{\n      font-size: 11px;\n      padding: 3px 9px;\n      border-radius: 999px;\n      border: 1px solid #4b5563;\n      background: #020617;\n      color: #e5e7eb;\n      cursor: pointer;\n      white-space: nowrap;\n    }}\n    .btn:hover {{\n      background: #030712;\n    }}\n\n    .icon-btn {{\n      width: 22px;\n      height: 22px;\n      border-radius: 999px;\n      border: 1px solid #4b5563;\n      background: #020617;\n      color: #9ca3af;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 12px;\n      cursor: pointer;\n      padding: 0;\n    }}\n    .icon-btn:hover {{\n      background: #030712;\n      color: #e5e7eb;\n    }}\n\n    .canvas-wrapper {{\n      position: relative;\n      border-radius: 10px;\n      overflow: hidden;\n      border: 1px solid #1f2933;\n      background: #020617;\n    }}\n\n    canvas {{\n      display: block;\n    }}\n\n    .status {{\n      margin-top: 6px;\n      font-size: 11px;\n      color: #9ca3af;\n      text-align: center;\n    }}\n\n    .overlay {{\n      position: absolute;\n      inset: 0;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      pointer-events: none;\n    }}\n\n    .overlay-content {{\n      padding: 6px 12px;\n      border-radius: 999px;\n      background: rgba(15, 23, 42, 0.85);\n      border: 1px solid rgba(248, 250, 252, 0.15);\n      font-size: 12px;\n      color: #e5e7eb;\n      backdrop-filter: blur(3px);\n\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n\n      pointer-events: auto;\n    }}\n\n    .settings-backdrop {{\n      position: absolute;\n      inset: 0;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      background: rgba(15, 23, 42, 0.75);\n      backdrop-filter: blur(4px);\n      z-index: 30;\n    }}\n\n    .settings-modal {{\n      width: 280px;\n      max-width: 90%;\n      border-radius: 12px;\n      background: #020617;\n      border: 1px solid #1f2937;\n      padding: 10px 12px 12px;\n      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.8);\n      font-size: 11px;\n    }}\n\n    .settings-header {{\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 6px;\n    }}\n\n    .settings-title {{\n      font-size: 12px;\n      font-weight: 500;\n      color: #e5e7eb;\n    }}\n\n    .settings-body {{\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n      margin-bottom: 8px;\n    }}\n\n    .settings-row {{\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 6px;\n      flex-wrap: wrap;\n    }}\n\n    .settings-row label {{\n      color: #9ca3af;\n      font-size: 11px;\n    }}\n\n    .settings-row input[type=\"number\"],\n    .settings-row select {{\n      font-size: 11px;\n      padding: 2px 4px;\n      border-radius: 6px;\n      border: 1px solid #4b5563;\n      background: #020617;\n      color: #e5e7eb;\n      width: 70px;\n    }}\n\n    .settings-row input[type=\"range\"] {{\n      flex: 1;\n    }}\n\n    .settings-row .value-label {{\n      width: 50px;\n      text-align: right;\n      color: #e5e7eb;\n      font-variant-numeric: tabular-nums;\n    }}\n\n    .settings-footer {{\n      display: flex;\n      justify-content: flex-end;\n      gap: 6px;\n    }}\n\n    .settings-row input[type=\"checkbox\"] {{\n      transform: scale(0.88);\n    }}\n\n    .settings-row .inline-inputs {{\n      display: flex;\n      gap: 4px;\n      align-items: center;\n    }}\n    .settings-row .inline-inputs span {{\n      font-size: 10px;\n      color: #6b7280;\n    }}\n  </style>\n</head>\n<body>\n  <div class=\"wrapper\">\n    <h1>Flappy Bird</h1>\n    <p class=\"subtitle\">Space or click to flap ¬∑ Avoid the pipes</p>\n\n    <div class=\"game-card\" id=\"game-card\">\n      <div class=\"hud\">\n        <div class=\"hud-left\">\n          <div class=\"hud-row\">\n            <span>Score: <span id=\"score\">0</span></span>\n            <span>¬∑</span>\n            <span>Best: <span id=\"best\">0</span></span>\n          </div>\n        </div>\n        <div style=\"display:flex; align-items:center; gap:6px;\">\n          <button class=\"icon-btn\" id=\"settings-btn\" title=\"Settings\">‚öô</button>\n          <button class=\"icon-btn\" id=\"restart-btn\" title=\"Restart\">‚Üª</button>\n        </div>\n      </div>\n\n      <div class=\"canvas-wrapper\" id=\"canvas-wrapper\">\n        <canvas id=\"game\"></canvas>\n        <div class=\"overlay\" id=\"overlay\" style=\"display:none;\">\n          <div class=\"overlay-content\">\n            <span id=\"overlay-label\">Game over</span>\n            <button class=\"btn\" id=\"overlay-restart\">‚Üª</button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"status\" id=\"status\">\n        Press Space or click inside the game to start\n      </div>\n\n      <div class=\"settings-backdrop\" id=\"settings-backdrop\">\n        <div class=\"settings-modal\" id=\"settings-modal\">\n          <div class=\"settings-header\">\n            <div class=\"settings-title\">Settings</div>\n            <button class=\"icon-btn\" id=\"settings-close\" title=\"Close\">‚úï</button>\n          </div>\n          <div class=\"settings-body\">\n            <div class=\"settings-row\">\n              <label for=\"difficulty-input\">Difficulty</label>\n              <select id=\"difficulty-input\">\n                <option value=\"easy\">Easy</option>\n                <option value=\"normal\">Normal</option>\n                <option value=\"hard\">Hard</option>\n              </select>\n            </div>\n\n            <div class=\"settings-row\">\n              <label for=\"speed-input\">Speed</label>\n              <input id=\"speed-input\" type=\"range\" min=\"0.5\" max=\"2.0\" step=\"0.1\" />\n              <div class=\"value-label\" id=\"speed-value\">1.0x</div>\n            </div>\n\n            <div class=\"settings-row\">\n              <label for=\"gravity-input\">Gravity</label>\n              <input id=\"gravity-input\" type=\"range\" min=\"0.2\" max=\"1.0\" step=\"0.05\" />\n              <div class=\"value-label\" id=\"gravity-value\">0.40</div>\n            </div>\n\n            <div class=\"settings-row\">\n              <label for=\"jump-input\">Jump</label>\n              <input id=\"jump-input\" type=\"range\" min=\"-15\" max=\"-3\" step=\"0.5\" />\n              <div class=\"value-label\" id=\"jump-value\">-7.5</div>\n            </div>\n\n            <div class=\"settings-row\">\n              <label>Gap (min / max)</label>\n              <div class=\"inline-inputs\">\n                <input id=\"gap-min-input\" type=\"number\" min=\"60\" max=\"260\" />\n                <span>/</span>\n                <input id=\"gap-max-input\" type=\"number\" min=\"70\" max=\"260\" />\n              </div>\n            </div>\n\n            <div class=\"settings-row\">\n              <label>Distance (min / max)</label>\n              <div class=\"inline-inputs\">\n                <input id=\"dist-min-input\" type=\"number\" min=\"80\" max=\"500\" />\n                <span>/</span>\n                <input id=\"dist-max-input\" type=\"number\" min=\"100\" max=\"500\" />\n              </div>\n            </div>\n\n            <div class=\"settings-row\">\n              <label>Width (min / max)</label>\n              <div class=\"inline-inputs\">\n                <input id=\"width-min-input\" type=\"number\" min=\"30\" max=\"140\" />\n                <span>/</span>\n                <input id=\"width-max-input\" type=\"number\" min=\"35\" max=\"140\" />\n              </div>\n            </div>\n\n            <div class=\"settings-row\">\n              <label for=\"save-scores-input\">Save best score</label>\n              <input id=\"save-scores-input\" type=\"checkbox\" />\n            </div>\n          </div>\n          <div class=\"settings-footer\">\n            <button class=\"btn\" id=\"settings-apply\">Apply</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function () {{\n      const TOOL_DEFAULTS = {{\n        speed: {v.speed},\n        gravity: {v.gravity},\n        jumpForce: {v.jump_force},\n        minGap: {v.min_gap},\n        maxGap: {v.max_gap},\n        minPipeDistance: {v.min_pipe_distance},\n        maxPipeDistance: {v.max_pipe_distance},\n        minPipeWidth: {v.min_pipe_width},\n        maxPipeWidth: {v.max_pipe_width},\n        saveScores: {str(v.save_scores).lower()},\n        difficulty: \"{v.difficulty.lower()}\",\n      }};\n\n      const STORAGE_KEY = \"flappy_best_v1\";\n\n      const gameCard = document.getElementById(\"game-card\");\n      const canvasWrapper = document.getElementById(\"canvas-wrapper\");\n      const canvas = document.getElementById(\"game\");\n      const scoreEl = document.getElementById(\"score\");\n      const bestEl = document.getElementById(\"best\");\n      const statusEl = document.getElementById(\"status\");\n\n      const overlay = document.getElementById(\"overlay\");\n      const overlayLabel = document.getElementById(\"overlay-label\");\n      const overlayRestart = document.getElementById(\"overlay-restart\");\n\n      const restartBtn = document.getElementById(\"restart-btn\");\n      const settingsBtn = document.getElementById(\"settings-btn\");\n      const settingsBackdrop = document.getElementById(\"settings-backdrop\");\n      const settingsClose = document.getElementById(\"settings-close\");\n      const settingsApply = document.getElementById(\"settings-apply\");\n\n      const difficultyInput = document.getElementById(\"difficulty-input\");\n      const speedInput = document.getElementById(\"speed-input\");\n      const speedValue = document.getElementById(\"speed-value\");\n      const gravityInput = document.getElementById(\"gravity-input\");\n      const gravityValue = document.getElementById(\"gravity-value\");\n      const jumpInput = document.getElementById(\"jump-input\");\n      const jumpValue = document.getElementById(\"jump-value\");\n      const gapMinInput = document.getElementById(\"gap-min-input\");\n      const gapMaxInput = document.getElementById(\"gap-max-input\");\n      const distMinInput = document.getElementById(\"dist-min-input\");\n      const distMaxInput = document.getElementById(\"dist-max-input\");\n      const widthMinInput = document.getElementById(\"width-min-input\");\n      const widthMaxInput = document.getElementById(\"width-max-input\");\n      const saveScoresInput = document.getElementById(\"save-scores-input\");\n\n      const WIDTH = 320;\n      const HEIGHT = 480;\n      const GROUND_HEIGHT = 40;\n      const BIRD_X = 80;\n\n      const BASE_PIPE_CONFIG = {{\n        easy:   {{ baseSpeed: 1.6, accelPerScore: 0.03 }},\n        normal: {{ baseSpeed: 2.1, accelPerScore: 0.05 }},\n        hard:   {{ baseSpeed: 2.6, accelPerScore: 0.08 }},\n      }};\n\n      let ctx;\n\n      let birdY;\n      let birdVy;\n\n      let pipes = [];\n      let score = 0;\n      let best = 0;\n\n      let running = false;\n      let paused = false;\n      let gameOverFlag = false;\n      let lastTime = 0;\n\n      let animTime = 0;\n      let lastFlapAt = 0;\n\n      let speedMultiplier = TOOL_DEFAULTS.speed || 1.0;\n      let gravity = TOOL_DEFAULTS.gravity || 0.4;\n      let jumpForce = TOOL_DEFAULTS.jumpForce || -7.5;\n\n      let minGap = TOOL_DEFAULTS.minGap || 90;\n      let maxGap = TOOL_DEFAULTS.maxGap || 140;\n      if (minGap > maxGap) [minGap, maxGap] = [maxGap, minGap];\n\n      let minPipeDistance = TOOL_DEFAULTS.minPipeDistance || 150;\n      let maxPipeDistance = TOOL_DEFAULTS.maxPipeDistance || 260;\n      if (minPipeDistance > maxPipeDistance) [minPipeDistance, maxPipeDistance] = [maxPipeDistance, minPipeDistance];\n\n      let minPipeWidth = TOOL_DEFAULTS.minPipeWidth || 45;\n      let maxPipeWidth = TOOL_DEFAULTS.maxPipeWidth || 65;\n      if (minPipeWidth > maxPipeWidth) [minPipeWidth, maxPipeWidth] = [maxPipeWidth, minPipeWidth];\n\n      let saveScores = !!TOOL_DEFAULTS.saveScores;\n      let difficulty = [\"easy\",\"normal\",\"hard\"].includes(TOOL_DEFAULTS.difficulty) ? TOOL_DEFAULTS.difficulty : \"normal\";\n\n      let pipeSpeed = 2.0;\n      let distanceSinceLastPipePx = 0;\n      let nextPipeDistancePx = 0;\n\n      function randInRange(min, max) {{\n        return Math.random() * (max - min) + min;\n      }}\n\n      function pickNextPipeDistance() {{\n        let minD = Math.max(80, Math.min(minPipeDistance, maxPipeDistance));\n        let maxD = Math.max(minD + 10, Math.max(minPipeDistance, maxPipeDistance));\n\n        const maxW = Math.max(minPipeWidth, maxPipeWidth);\n        const safeMin = Math.max(minD, maxW + 20);\n        const safeMax = Math.max(safeMin + 10, maxD);\n\n        nextPipeDistancePx = randInRange(safeMin, safeMax);\n      }}\n\n      function setupCanvas() {{\n        canvas.width = WIDTH;\n        canvas.height = HEIGHT;\n        canvasWrapper.style.width = WIDTH + \"px\";\n        canvasWrapper.style.height = HEIGHT + \"px\";\n        ctx = canvas.getContext(\"2d\");\n      }}\n\n      function syncSettingsUI() {{\n        difficultyInput.value = difficulty;\n\n        speedInput.value = speedMultiplier.toFixed(1);\n        speedValue.textContent = speedMultiplier.toFixed(1) + \"x\";\n\n        gravityInput.value = gravity.toFixed(2);\n        gravityValue.textContent = gravity.toFixed(2);\n\n        jumpInput.value = jumpForce;\n        jumpValue.textContent = jumpForce.toFixed(1);\n\n        gapMinInput.value = minGap.toString();\n        gapMaxInput.value = maxGap.toString();\n        distMinInput.value = minPipeDistance.toString();\n        distMaxInput.value = maxPipeDistance.toString();\n        widthMinInput.value = minPipeWidth.toString();\n        widthMaxInput.value = maxPipeWidth.toString();\n\n        saveScoresInput.checked = saveScores;\n      }}\n\n      function loadBestFromStorage() {{\n        if (!saveScores || !(\"localStorage\" in window)) return;\n        try {{\n          const raw = window.localStorage.getItem(STORAGE_KEY);\n          const n = raw ? parseInt(raw, 10) : NaN;\n          if (!Number.isNaN(n) && n > 0) {{\n            best = n;\n            bestEl.textContent = best.toString();\n          }}\n        }} catch (_) {{}}\n      }}\n\n      function saveBestToStorage() {{\n        if (!saveScores || !(\"localStorage\" in window)) return;\n        try {{\n          window.localStorage.setItem(STORAGE_KEY, String(best));\n        }} catch (_) {{}}\n      }}\n\n      function resetGame() {{\n        birdY = HEIGHT / 2;\n        birdVy = 0;\n\n        pipes = [];\n        score = 0;\n        scoreEl.textContent = \"0\";\n\n        running = false;\n        paused = false;\n        gameOverFlag = false;\n        lastTime = 0;\n        animTime = 0;\n        lastFlapAt = 0;\n\n        distanceSinceLastPipePx = 0;\n        pickNextPipeDistance();\n\n        statusEl.textContent = \"Press Space or click inside the game to start\";\n\n        overlay.style.display = \"none\";\n\n        spawnPipe();\n        draw(animTime);\n      }}\n\n      function flap() {{\n        if (gameOverFlag) {{\n          resetGame();\n          return;\n        }}\n        if (!running) {{\n          running = true;\n          paused = false;\n          statusEl.textContent = \"Flap through the gaps and avoid the ground\";\n        }}\n        birdVy = jumpForce;\n        lastFlapAt = animTime;\n      }}\n\n      function spawnPipe() {{\n        const groundY = HEIGHT - GROUND_HEIGHT;\n        const margin = 40;\n\n        let gapHMin = Math.max(60, Math.min(minGap, maxGap));\n        let gapHMax = Math.max(gapHMin + 10, Math.max(minGap, maxGap));\n        let gapHeight = randInRange(gapHMin, gapHMax);\n\n        const maxGapHeightAllowed = groundY - margin * 2;\n        if (gapHeight > maxGapHeightAllowed) gapHeight = maxGapHeightAllowed;\n\n        const maxTop = groundY - margin - gapHeight;\n        const minTop = margin;\n        const gapTop = randInRange(minTop, maxTop);\n\n        let wMin = Math.max(30, Math.min(minPipeWidth, maxPipeWidth));\n        let wMax = Math.max(wMin + 5, Math.max(minPipeWidth, maxPipeWidth));\n        const pipeWidth = randInRange(wMin, wMax);\n\n        pipes.push({{\n          x: WIDTH + pipeWidth,\n          width: pipeWidth,\n          gapTop,\n          gapHeight,\n          scored: false,\n        }});\n      }}\n\n      function update(dt) {{\n        if (!running || paused || gameOverFlag) return;\n\n        const cfg = BASE_PIPE_CONFIG[difficulty] || BASE_PIPE_CONFIG.normal;\n        pipeSpeed = (cfg.baseSpeed + cfg.accelPerScore * score) * (speedMultiplier || 1.0);\n\n        birdVy += gravity;\n        birdY += birdVy;\n\n        const groundY = HEIGHT - GROUND_HEIGHT;\n        if (birdY + 10 >= groundY || birdY - 10 <= 0) {{\n          gameOver();\n          return;\n        }}\n\n        for (let i = 0; i < pipes.length; i++) {{\n          pipes[i].x -= pipeSpeed * dt;\n        }}\n\n        while (pipes.length && pipes[0].x + pipes[0].width < 0) {{\n          pipes.shift();\n        }}\n\n        const birdRadius = 10;\n        const birdLeft = BIRD_X - birdRadius;\n        const birdRight = BIRD_X + birdRadius;\n        const birdTop = birdY - birdRadius;\n        const birdBottom = birdY + birdRadius;\n\n        for (let i = 0; i < pipes.length; i++) {{\n          const p = pipes[i];\n\n          const pipeLeft = p.x;\n          const pipeRight = p.x + p.width;\n          const gapTop = p.gapTop;\n          const gapBottom = p.gapTop + p.gapHeight;\n\n          const horizontallyOverlapping = birdRight > pipeLeft && birdLeft < pipeRight;\n          const verticallyOutsideGap = birdTop < gapTop || birdBottom > gapBottom;\n\n          if (horizontallyOverlapping && verticallyOutsideGap) {{\n            gameOver();\n            return;\n          }}\n\n          if (!p.scored && pipeRight < BIRD_X) {{\n            p.scored = true;\n            score += 1;\n            scoreEl.textContent = score.toString();\n            if (score > best) {{\n              best = score;\n              bestEl.textContent = best.toString();\n              saveBestToStorage();\n            }}\n          }}\n        }}\n\n        distanceSinceLastPipePx += pipeSpeed * dt;\n        if (distanceSinceLastPipePx >= nextPipeDistancePx) {{\n          distanceSinceLastPipePx = 0;\n          pickNextPipeDistance();\n          spawnPipe();\n        }}\n      }}\n\n      function gameOver() {{\n        running = false;\n        paused = false;\n        gameOverFlag = true;\n\n        statusEl.textContent = \"You crashed. Press Restart, Space, or click to try again\";\n\n        overlayLabel.textContent = \"Game over\";\n        overlay.style.display = \"flex\";\n      }}\n\n      function drawBackground() {{\n        const gradient = ctx.createLinearGradient(0, 0, 0, HEIGHT);\n        gradient.addColorStop(0, \"#0f172a\");\n        gradient.addColorStop(0.6, \"#1f2937\");\n        gradient.addColorStop(1, \"#0b1120\");\n        ctx.fillStyle = gradient;\n        ctx.fillRect(0, 0, WIDTH, HEIGHT);\n      }}\n\n      function drawGround() {{\n        const y = HEIGHT - GROUND_HEIGHT;\n        ctx.fillStyle = \"#064e3b\";\n        ctx.fillRect(0, y, WIDTH, GROUND_HEIGHT);\n        ctx.fillStyle = \"#16a34a\";\n        ctx.fillRect(0, y, WIDTH, 6);\n      }}\n\n      function drawPipes() {{\n        const groundY = HEIGHT - GROUND_HEIGHT;\n        ctx.fillStyle = \"#22c55e\";\n\n        for (let i = 0; i < pipes.length; i++) {{\n          const p = pipes[i];\n\n          const pipeLeft = p.x;\n          const pipeWidth = p.width;\n          const gapTop = p.gapTop;\n          const gapBottom = p.gapTop + p.gapHeight;\n\n          const clampedGapTop = Math.max(0, Math.min(gapTop, groundY));\n          const clampedGapBottom = Math.max(0, Math.min(gapBottom, groundY));\n\n          const topHeight = clampedGapTop;\n          const bottomHeight = groundY - clampedGapBottom;\n\n          if (topHeight > 0) {{\n            ctx.fillRect(pipeLeft, 0, pipeWidth, topHeight);\n          }}\n\n          if (bottomHeight > 0) {{\n            ctx.fillRect(pipeLeft, clampedGapBottom, pipeWidth, bottomHeight);\n          }}\n        }}\n      }}\n\n      function drawBird(t) {{\n        const r = 11;\n        const centerX = BIRD_X;\n        const centerY = birdY;\n\n        const tilt = Math.max(-0.4, Math.min(0.9, birdVy / 9));\n\n        const baseWave = Math.sin(t * 0.25) * 0.25;\n        const sinceFlap = t - lastFlapAt;\n        const flapBoost = Math.max(0, 1 - sinceFlap / 8);\n        const wingAngle = baseWave + flapBoost * 0.9;\n\n        ctx.save();\n        ctx.translate(centerX, centerY);\n        ctx.rotate(tilt);\n\n        ctx.beginPath();\n        ctx.arc(0, 0, r, 0, Math.PI * 2);\n        ctx.closePath();\n        ctx.fillStyle = \"#facc15\";\n        ctx.fill();\n\n        ctx.beginPath();\n        ctx.arc(-3, 3, r * 0.7, Math.PI * 0.2, Math.PI * 1.1);\n        ctx.strokeStyle = \"rgba(0,0,0,0.15)\";\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n        ctx.save();\n        ctx.translate(-3, 0);\n        ctx.rotate(wingAngle);\n        ctx.beginPath();\n        if (ctx.roundRect) {{\n          ctx.roundRect(-6, -4, 12, 8, 3);\n        }} else {{\n          ctx.rect(-6, -4, 12, 8);\n        }}\n        ctx.fillStyle = \"#eab308\";\n        ctx.fill();\n        ctx.restore();\n\n        ctx.beginPath();\n        ctx.arc(4, -4, 3.2, 0, Math.PI * 2);\n        ctx.fillStyle = \"#f9fafb\";\n        ctx.fill();\n\n        ctx.beginPath();\n        ctx.arc(5, -4.3, 1.6, 0, Math.PI * 2);\n        ctx.fillStyle = \"#020617\";\n        ctx.fill();\n\n        ctx.fillStyle = \"#f97316\";\n        ctx.beginPath();\n        ctx.moveTo(r, -1);\n        ctx.lineTo(r + 7, -4);\n        ctx.lineTo(r + 7, 2);\n        ctx.closePath();\n        ctx.fill();\n\n        ctx.restore();\n      }}\n\n      function draw(t) {{\n        if (!ctx) return;\n\n        ctx.clearRect(0, 0, WIDTH, HEIGHT);\n\n        drawBackground();\n        drawPipes();\n        drawGround();\n        drawBird(t || 0);\n      }}\n\n      function loop(timestamp) {{\n        requestAnimationFrame(loop);\n\n        if (lastTime === 0) {{\n          lastTime = timestamp;\n          animTime = 0;\n          draw(animTime);\n          return;\n        }}\n\n        const dt = (timestamp - lastTime) / 16.67;\n        lastTime = timestamp;\n\n        animTime += dt;\n\n        if (!running || paused) {{\n          draw(animTime);\n          return;\n        }}\n\n        update(dt);\n        draw(animTime);\n      }}\n\n      function openSettings() {{\n        paused = true;\n        settingsBackdrop.style.display = \"flex\";\n        syncSettingsUI();\n      }}\n\n      function closeSettings() {{\n        settingsBackdrop.style.display = \"none\";\n      }}\n\n      settingsBtn.addEventListener(\"click\", openSettings);\n      settingsClose.addEventListener(\"click\", closeSettings);\n      settingsBackdrop.addEventListener(\"click\", (e) => {{\n        if (e.target === settingsBackdrop) closeSettings();\n      }});\n\n      speedInput.addEventListener(\"input\", () => {{\n        const v = parseFloat(speedInput.value) || 1.0;\n        speedValue.textContent = v.toFixed(1) + \"x\";\n      }});\n\n      gravityInput.addEventListener(\"input\", () => {{\n        const v = parseFloat(gravityInput.value) || 0.4;\n        gravityValue.textContent = v.toFixed(2);\n      }});\n\n      jumpInput.addEventListener(\"input\", () => {{\n        const v = parseFloat(jumpInput.value) || -7.5;\n        jumpValue.textContent = v.toFixed(1);\n      }});\n\n      settingsApply.addEventListener(\"click\", () => {{\n        const newDiff = difficultyInput.value;\n        difficulty = [\"easy\",\"normal\",\"hard\"].includes(newDiff) ? newDiff : difficulty;\n\n        const newSpeed = parseFloat(speedInput.value);\n        if (!Number.isNaN(newSpeed) && newSpeed >= 0.5 && newSpeed <= 2.0) {{\n          speedMultiplier = newSpeed;\n        }}\n\n        const newGravity = parseFloat(gravityInput.value);\n        if (!Number.isNaN(newGravity) && newGravity >= 0.2 && newGravity <= 1.0) {{\n          gravity = newGravity;\n        }}\n\n        const newJump = parseFloat(jumpInput.value);\n        if (!Number.isNaN(newJump) && newJump >= -15 && newJump <= -3) {{\n          jumpForce = newJump;\n        }}\n\n        let gMin = parseInt(gapMinInput.value, 10);\n        let gMax = parseInt(gapMaxInput.value, 10);\n        if (!Number.isNaN(gMin) && !Number.isNaN(gMax)) {{\n          gMin = Math.max(60, Math.min(260, gMin));\n          gMax = Math.max(70, Math.min(260, gMax));\n          if (gMin > gMax) [gMin, gMax] = [gMax, gMin];\n          minGap = gMin;\n          maxGap = gMax;\n        }}\n\n        let dMin = parseInt(distMinInput.value, 10);\n        let dMax = parseInt(distMaxInput.value, 10);\n        if (!Number.isNaN(dMin) && !Number.isNaN(dMax)) {{\n          dMin = Math.max(80, Math.min(500, dMin));\n          dMax = Math.max(100, Math.min(500, dMax));\n          if (dMin > dMax) [dMin, dMax] = [dMax, dMin];\n          minPipeDistance = dMin;\n          maxPipeDistance = dMax;\n        }}\n\n        let wMin = parseInt(widthMinInput.value, 10);\n        let wMax = parseInt(widthMaxInput.value, 10);\n        if (!Number.isNaN(wMin) && !Number.isNaN(wMax)) {{\n          wMin = Math.max(30, Math.min(140, wMin));\n          wMax = Math.max(35, Math.min(140, wMax));\n          if (wMin > wMax) [wMin, wMax] = [wMax, wMin];\n          minPipeWidth = wMin;\n          maxPipeWidth = wMax;\n        }}\n\n        saveScores = saveScoresInput.checked;\n\n        const maxW = Math.max(minPipeWidth, maxPipeWidth);\n        if (minPipeDistance <= maxW + 10) {{\n          minPipeDistance = maxW + 10;\n        }}\n        if (maxPipeDistance <= minPipeDistance + 10) {{\n          maxPipeDistance = minPipeDistance + 10;\n        }}\n\n        setupCanvas();\n        resetGame();\n        loadBestFromStorage();\n        closeSettings();\n      }});\n\n      restartBtn.addEventListener(\"click\", () => {{\n        resetGame();\n      }});\n\n      overlayRestart.addEventListener(\"click\", () => {{\n        resetGame();\n      }});\n\n      function handleKey(e) {{\n        const key = e.key.toLowerCase();\n        if (key === \" \" || key === \"spacebar\") {{\n          e.preventDefault();\n          flap();\n        }}\n      }}\n\n      function handleClick() {{\n        flap();\n      }}\n\n      window.addEventListener(\"keydown\", handleKey);\n      canvasWrapper.addEventListener(\"click\", handleClick);\n\n      window.addEventListener(\"blur\", () => {{\n        gameCard.classList.remove(\"focused\");\n        if (running && !gameOverFlag) {{\n          paused = true;\n          statusEl.textContent = \"Out of focus. Click back or press Space to resume\";\n        }}\n      }});\n\n      window.addEventListener(\"focus\", () => {{\n        gameCard.classList.add(\"focused\");\n        if (paused && running && !gameOverFlag) {{\n          paused = false;\n          statusEl.textContent = \"Flap through the gaps and avoid the ground\";\n        }}\n      }});\n\n      // Init\n      setupCanvas();\n      resetGame();\n      loadBestFromStorage();\n      requestAnimationFrame(loop);\n    }})();\n  </script>\n</body>\n</html>\"\"\"\n\n        headers = {\n            \"Content-Disposition\": \"inline\",\n            \"Content-Type\": \"text/html; charset=utf-8\",\n        }\n        return HTMLResponse(content=html_content, headers=headers)\n","specs":[{"name":"start_flappy_bird","description":"","parameters":{"properties":{},"type":"object"}}],"meta":{"description":"Flappy Bird Mini Game","manifest":{"title":"üê• Flappy Bird Mini Game","author":"Helmi Chaouachi","git_url":"https://github.com/Helmi97/open-webui-extensions/tree/main/flappy_bird","description":"A Flappy Bird style mini game with random pipe widths, gaps, and spacing, difficulty-based speed scaling, and configurable behavior via Open WebUI valves.","required_open_webui_version":"0.4.0","requirements":"","version":"1.2.0","licence":"MIT"}},"access_control":{},"updated_at":1765367177,"created_at":1765325269}]